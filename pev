# TODO: show pev variables in columns using "paste" and two separate arrays.
# TODO: update messages (e.g: pevshow --> pev show & etc.)
# TODO: do not allow "add" "delete" "show" "help|--help" "version|--version" "error" as pev names.
# TODO: Apalog it!
# TODO: Use regex in the ~/.pev for the case "*" instead of searching through the whole environment variables
# TODO: Put hard-coded ~/.pev in a variable.
pev(){
	case $1 in
	init)
		touch ~/.pev
		source ~/.pev
	;;	
	add)
		if [[ ! -z "${!2}" ]]; then echo -e -n "\tError: This name exists already.\n\t$2="; eval "echo \${$2}"; return; fi
		if [[ -z $3 ]]; then echo -e -n "\tError: Value is not entered. Create a pev variable like this: \"pevadd NAME VALUE\"\n\""; return; fi
		echo "export pev_$2=\"$3\"" | sudo tee -a ~/.pev > /dev/null
		echo "environment variable \"pev_$2\" added successfully. \"pevshow\" to see the list of pev variables."
		source ~/.pev
	;;
	delete)
		if [[ ! -e ~/.pev ]]; then pevinit; fi
		touch pevtemp
		pevdeletebool=false
		while read -r line
			do
				if [[ ! $line =~ "export pev_$2=" ]]
				then
					echo "$line"
				else
					pevdeletebool=true
				fi
			done <~/.pev > >(sudo tee -a pevtemp > /dev/null)
			if [[ $pevdeletebool = true ]]; then echo "unset pev_$2" | tee pevtemp2 > /dev/null; source pevtemp2; rm pevtemp2; fi
		sudo mv pevtemp ~/.pev
		source ~/.pev
	;;
	show)
		if [[ ! -e ~/.pev ]]; then pevinit; fi
		pevarray=$( (cat ~/.pev | grep -P -o '[\w_]*?=["\w\/]+?$') )
		if [[ ! ${#pevarray[@]} -eq 0 ]]
		then
			printf '\t%s\n' ${pevarray[@]}
		else
			echo "no pev variables exist"
		fi
	;;
	edit)
		if [[ ! -e ~/.pev ]]; then pevinit; fi
		sudo nano ~/.pev
		source ~/.pev
	;;
	help|--help)
		echo -e "\n\tPEV-Version-0.2"
		echo -e "\n\tpev [ <NAME> | add <NAME> <VALUE> | delete <NAME> | show | edit | help ]\n"
		echo -e "\tpev <NAME>: \n\t\techos the value of Personal Environment Variable named <NAME>\n"
		echo -e "\tpev add <NAME> <VALUE>:\n\t\tAdds a Personal Environment Variable\n"
		echo -e "\tpev delete <NAME>:\n\t\tDeletes a Personal Environment Variable\n"
		echo -e "\tpev show:\n\t\tShows a list of Personal Environment Variables\n"
		echo -e "\tpev edit:\n\t\tEdit the list of Personal Environment Variables manually(NOT RECOMMENDED)\n"
	;;
	version|--version)
		echo -e "\n\tPEV-Version-0.2\n"
	;;
	error)
		echo -e "\n\tpev [ <NAME> | add <NAME> <VALUE> | delete <NAME> | show | edit | help ]\n"
	;;
	*)
		pevreq=pev_$1
		if [[ ! -z ${!pevreq} ]]
		then
			eval "echo \$pev_$1"
		else
			pev error
		fi
	;;
	esac
}
